---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Nav from "../../components/Nav.astro";
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";
import ProjectCard from "../../components/ProjectCard.astro";
import { createPath } from "../../utils/paths";

const modules = import.meta.glob('./*.astro', { eager: true });
const projects = Object.entries(modules)
  .filter(([p]) => !/\/(index|\[.*\])\.astro$/.test(p))
  .map(([path, mod]: any) => ({
    ...(mod?.meta ?? {}),
    slug: (mod?.meta?.slug) ?? path.replace(/^\.\/(.*)\.astro$/, '$1')
  }))
  .filter((p) => p && p.title)
  .sort((a, b) => (a.title || '').localeCompare(b.title || ''));
  
---
<BaseLayout title="Projects">
  <Fragment slot="nav"><Nav /></Fragment>
  <Fragment slot="header"><Header /></Fragment>
  <Fragment slot="footer"><Footer /></Fragment>

  <ul class="grid gap-4 sm:grid-cols-2">
    {projects.map((project) => (
      <ProjectCard project={project} />
    ))}
  </ul>
</BaseLayout>
