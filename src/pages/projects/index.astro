---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Nav from "../../components/Nav.astro";
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";

const modules = import.meta.glob('./*.astro', { eager: true });
const projects = Object.entries(modules)
  .filter(([p]) => !/\/(index|\[.*\])\.astro$/.test(p))
  .map(([path, mod]: any) => ({
    ...(mod?.meta ?? {}),
    slug: (mod?.meta?.slug) ?? path.replace(/^\.\/(.*)\.astro$/, '$1')
  }))
  .filter((p) => p && p.title)
  .sort((a, b) => (a.title || '').localeCompare(b.title || ''));
---
<BaseLayout title="Projects">
  <Fragment slot="nav"><Nav /></Fragment>
  <Fragment slot="header"><Header /></Fragment>
  <Fragment slot="footer"><Footer /></Fragment>

  <h1 class="text-2xl font-bold mb-4">Projects</h1>
  <ul class="grid gap-4 sm:grid-cols-2">
    {projects.map((p) => (
      <li class="rounded border border-gray-200 bg-white p-4 shadow-sm transition hover:shadow hover:-translate-y-0.5">
        <a href={`/projects/${p.slug}`} class="no-underline">
          <div class="mb-2 flex items-center justify-between">
            <h2 class="text-lg font-semibold text-[#222]">{p.title}</h2>
            <span class={`inline-flex items-center rounded-full px-2 py-0.5 text-[10px] font-semibold ring-1 ring-inset ${p.status === 'in-progress' ? 'bg-blue-600/10 text-blue-700 ring-blue-600/30' : p.status === 'done' ? 'bg-emerald-600/10 text-emerald-700 ring-emerald-600/30' : p.status === 'paused' ? 'bg-amber-600/10 text-amber-700 ring-amber-600/30' : 'bg-gray-500/10 text-gray-700 ring-gray-500/30'}`}>{p.status ?? 'tbd'}</span>
          </div>
          {p.role && <p class="text-xs opacity-70 mb-1">Role: {p.role}</p>}
          {p.period && <p class="text-xs opacity-70 mb-1">Period: {p.period}</p>}
          <p class="text-sm opacity-90">{p.summary}</p>
        </a>
      </li>
    ))}
  </ul>
</BaseLayout>
