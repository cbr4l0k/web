---
import StandardPageLayout from "../layouts/StandardPageLayout.astro";
import CVSection from "../components/CVSection.astro";
import CVEntry from "../components/CVEntry.astro";
import CVProject from "../components/CVProject.astro";
import CVPublication from "../components/CVPublication.astro";
import { cvData } from "../data/me";

const { personal_info, last_updated, welcome, education, experience, publications, projects, technologies } = cvData;
---
<StandardPageLayout title="Me">
  <!-- Personal Header -->
  <div class="mb-12">
    <h1 class="text-4xl font-bold text-[var(--color-heading)] mb-4">{personal_info.name}</h1>

    <div class="flex flex-wrap gap-4 text-sm text-[var(--color-body)] mb-4">
      {personal_info.location && (
        <span class="flex items-center gap-1.5">
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
          </svg>
          {personal_info.location}
        </span>
      )}
      {personal_info.email && (
        <a href={`mailto:${personal_info.email}`} class="flex items-center gap-1.5 hover:underline">
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
          </svg>
          {personal_info.email}
        </a>
      )}
      {personal_info.phone && (
        <span class="flex items-center gap-1.5">
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
          </svg>
          {personal_info.phone}
        </span>
      )}
    </div>

    <div class="flex flex-wrap gap-3">
      {personal_info.website && (
        <a href={personal_info.website} target="_blank" rel="noopener noreferrer"
           class="inline-flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium border border-[var(--color-border)] rounded-lg hover:bg-gray-50 transition">
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9" />
          </svg>
          Website
        </a>
      )}
      {personal_info.linkedin && (
        <a href={personal_info.linkedin} target="_blank" rel="noopener noreferrer"
           class="inline-flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium border border-[var(--color-border)] rounded-lg hover:bg-gray-50 transition">
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8a3 3 0 100-6 3 3 0 000 6zm0 0v11m0 0a3 3 0 100 6 3 3 0 000-6zm10-3a3 3 0 100-6 3 3 0 000 6zm0 0c-1 2-3 3-5 3"/>
          </svg>
          Personal Repo
        </a>
      )}
      {personal_info.github && (
        <a href={personal_info.github} target="_blank" rel="noopener noreferrer"
           class="inline-flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium border border-[var(--color-border)] rounded-lg hover:bg-gray-50 transition">
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
            <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"/>
          </svg>
          GitHub
        </a>
      )}
    </div>

    {last_updated && (
      <p class="text-xs text-[var(--color-muted)] mt-4">Last updated: {last_updated}</p>
    )}
  </div>

  <!-- Welcome Section (Optional) -->
  {welcome && (
    <div class="mb-12 rounded-lg border border-[var(--color-border)] p-6 shadow-sm">
      <h2 class="text-xl font-semibold text-[var(--color-heading)] mb-3">{welcome.title}</h2>
      {welcome.content.map((paragraph) => (
        <p class="text-sm text-[var(--color-body)] mb-3 last:mb-0 leading-relaxed">{paragraph}</p>
      ))}
    </div>
  )}

  <!-- Experience Section -->
  {experience && experience.length > 0 && (
    <CVSection title="Experience" id="experience">
      {experience.map((exp) => (
        <CVEntry
          title={exp.position}
          subtitle={exp.company}
          metadata={exp.location}
          period={`${exp.start_date} - ${exp.end_date}`}
          highlights={exp.highlights}
        />
      ))}
    </CVSection>
  )}

  <!-- Education Section -->
  {education && education.length > 0 && (
    <CVSection title="Education" id="education">
      {education.map((edu) => (
        <CVEntry
          title={edu.degree}
          subtitle={edu.institution}
          period={`${edu.start_date} - ${edu.end_date}`}
          highlights={edu.highlights}
        />
      ))}
    </CVSection>
  )}

  <!-- Publications Section -->
  {publications && publications.length > 0 && (
    <CVSection title="Publications" id="publications">
      <div class="space-y-4">
        {publications.map((pub) => (
          <CVPublication
            title={pub.title}
            date={pub.date}
            authors={pub.authors}
            doi={pub.doi}
          />
        ))}
      </div>
    </CVSection>
  )}

  <!-- Projects Section -->
  {projects && projects.length > 0 && (
    <CVSection title="Projects" id="projects">
      <div class="grid gap-4 md:grid-cols-2">
        {projects.map((project) => (
          <CVProject
            name={project.name}
            link={project.link}
            date={project.date}
            highlights={project.highlights}
          />
        ))}
      </div>
    </CVSection>
  )}

  <!-- Technologies Section -->
  {technologies && technologies.length > 0 && (
    <CVSection title="Technologies & Skills" id="technologies">
      <div class="grid gap-4 sm:grid-cols-2">
        {technologies.map((tech) => (
          <div class="rounded-lg border border-[var(--color-border)] p-4 shadow-sm">
            <h3 class="text-sm font-semibold text-[var(--color-heading)] mb-2">{tech.category}</h3>
            <p class="text-sm text-[var(--color-body)]">{tech.items}</p>
          </div>
        ))}
      </div>
    </CVSection>
  )}
</StandardPageLayout>
