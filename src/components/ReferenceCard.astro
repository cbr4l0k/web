---
export interface Props {
  title: string;
  description: string;
  reference: string;
  url?: string;
}

const { title, description, reference, url } = Astro.props;
---

<li class="rounded border border-gray-300 p-2 transition hover:shadow hover:-translate-y-0.5 cursor-pointer reference-item">
  <div class="flex items-start sm:items-center justify-between gap-3 mb-1">
    <div class="flex items-start gap-2 flex-1 min-w-0">
      <svg class="chevron w-4 h-4 mt-0.5 flex-shrink-0 transition-transform duration-200 opacity-60" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
      </svg>
      <h4 class="text-base sm:text-sm font-semibold text-[#222] leading-tight">{title}</h4>
    </div>
    {url && (
      <a
        href={url}
        target="_blank"
        rel="noopener noreferrer"
        class="inline-flex items-center rounded-full px-2.5 py-1 text-[10px] font-semibold ring-1 ring-inset hover:bg-gray-50 transition-colors external-link whitespace-nowrap flex-shrink-0"
        onclick="event.stopPropagation()"
        aria-label="Open URL in new tab"
      >
        URL ðŸ”—
      </a>
    )}
  </div>
  <div class="reference-content overflow-hidden transition-all duration-300 ease-in-out" style="max-height: 0; opacity: 0;">
    <div class="pt-3 pl-6">
      <p class="text-sm opacity-90 mb-3 leading-relaxed">{description}</p>
      {reference && (
        <p class="text-xs opacity-70 italic border-t border-gray-200 pt-2 mt-2">{reference}</p>
      )}
    </div>
  </div>
</li>

<style>
  .reference-item.expanded .chevron {
    transform: rotate(90deg);
  }

  .reference-item.expanded .reference-content {
    max-height: 1000px !important;
    opacity: 1 !important;
  }

  @media (max-width: 640px) {
    .reference-item {
      padding: 1rem;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const referenceItems = document.querySelectorAll('.reference-item');

    referenceItems.forEach(item => {
      item.addEventListener('click', function(e) {
        // Don't toggle if clicking on the external link
        if ((e.target as HTMLElement).closest('.external-link')) {
          return;
        }

        this.classList.toggle('expanded');
      });

      // Make keyboard accessible
      item.setAttribute('tabindex', '0');
      item.setAttribute('role', 'button');
      item.setAttribute('aria-expanded', 'false');

      item.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          this.classList.toggle('expanded');
          this.setAttribute('aria-expanded', this.classList.contains('expanded').toString());
        }
      });
    });
  });
</script>
